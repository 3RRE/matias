!function ($) { var MAX_ROCKETS = 5, MAX_PARTICLES = 500, FUNCS = { init: function (e) { var t = $(e); if (void 0 !== t.data("fireworks_data")) return; var a = document.createElement("canvas"), i = document.createElement("canvas"), n = { element: e, canvas: a, context: a.getContext("2d"), canvas_buffer: i, context_buffer: i.getContext("2d"), particles: [], rockets: [] }; "static" === t.css("position") && (e.style.position = "relative"), e.appendChild(a), a.style.position = "absolute", a.style.top = "0", a.style.bottom = "0", a.style.left = "0", a.style.right = "0", n.interval = setInterval(r.bind(this, n), 20), t.data("fireworks_data", n) }, destroy: function (e) { var t = $(e); if (void 0 === t.data("fireworks_data")) return; var a = t.data("fireworks_data"); t.removeData("fireworks_data"), clearInterval(a.interval), a.canvas.remove(), a.element.style.position = "" } }; function r(e) { !function (e) { e.rockets.length < MAX_ROCKETS && e.rockets.push(new c(e)) }(e), e.canvas_width != e.element.offsetWidth && (e.canvas_width = e.canvas.width = e.canvas_buffer.width = e.element.offsetWidth), e.canvas_height != e.element.offsetHeight && (e.canvas_height = e.canvas.height = e.canvas_buffer.height = e.element.offsetHeight), e.context_buffer.clearRect(0, 0, e.canvas.width, e.canvas.height), e.context_buffer.globalAlpha = .9, e.context_buffer.drawImage(e.canvas, 0, 0), e.context.clearRect(0, 0, e.canvas.width, e.canvas.height), e.context.drawImage(e.canvas_buffer, 0, 0); var t = []; e.rockets.forEach(function (a) { a.update(), a.render(e.context); var i = a.pos.y < 2 * e.canvas.height / 3 ? .01 * Math.random() * 100 <= 1 : !1; a.pos.y < e.canvas.height / 5 || a.vel.y >= 0 || i ? a.explode(e) : t.push(a) }), e.rockets = t; var a = []; e.particles.forEach(function (t) { t.update(), t.exists() && (t.render(e.context), a.push(t)) }), e.particles = a; for (; e.particles.length > MAX_PARTICLES;)e.particles.shift() } function o(e) { this.pos = { x: e ? e.x : 0, y: e ? e.y : 0 }, this.vel = { x: 0, y: 0 }, this.shrink = .97, this.size = 2, this.resistance = 1, this.gravity = 0, this.flick = !1, this.alpha = 1, this.fade = 0, this.color = 0 } o.prototype.update = function () { this.vel.x *= this.resistance, this.vel.y *= this.resistance, this.vel.y += this.gravity, this.pos.x += this.vel.x, this.pos.y += this.vel.y, this.size *= this.shrink, this.alpha -= this.fade }, o.prototype.render = function (e) { if (this.exists()) { e.save(), e.globalCompositeOperation = "lighter"; var t = this.pos.x, a = this.pos.y, i = this.size / 2, n = e.createRadialGradient(t, a, .1, t, a, i); n.addColorStop(.1, "rgba(255,255,255," + this.alpha + ")"), n.addColorStop(.8, "hsla(" + this.color + ",100%,50%," + this.alpha + ")"), n.addColorStop(1, "hsla(" + this.color + ",100%,50%,.1)"), e.fillStyle = n, e.beginPath(), e.arc(this.pos.x, this.pos.y, this.flick ? Math.random() * this.size : this.size, 0, 2 * Math.PI, !0), e.closePath(), e.fill(), e.restore() } }, o.prototype.exists = function () { return this.alpha >= .1 && this.size >= 1 }; function c(e) { o.apply(this, [{ x: Math.random() * e.canvas.width * 2 / 3 + e.canvas.width / 6, y: e.canvas.height }]), this.explosionColor = 10 * Math.floor(36 * Math.random()), this.vel.y = -3 * Math.random() - 4, this.vel.x = 6 * Math.random() - 3, this.size = 2, this.shrink = .999, this.gravity = .01 } c.prototype = new o, c.prototype.constructor = c, c.prototype.explode = function (e) { for (var t = Math.random() * 10 + 80, a = 0; a < t; a++) { var i = new o(this.pos), n = 2 * Math.PI * Math.random(), r = 15 * Math.cos(.5 * Math.PI * Math.random()); i.vel.x = Math.cos(n) * r, i.vel.y = Math.sin(n) * r, i.size = 10, i.gravity = .2, i.resistance = .92, i.shrink = .93 + .05 * Math.random(), i.flick = !0, i.color = this.explosionColor, e.particles.push(i) } }, c.prototype.render = function (e) { if (this.exists()) { e.save(), e.globalCompositeOperation = "lighter"; var t = this.pos.x, a = this.pos.y, i = this.size / 2, n = e.createRadialGradient(t, a, .1, t, a, i); n.addColorStop(.1, "rgba(255,255,255," + this.alpha + ")"), n.addColorStop(.2, "rgba(255,180,0," + this.alpha + ")"), e.fillStyle = n, e.beginPath(), e.arc(this.pos.x, this.pos.y, this.flick ? .5 * Math.random() * this.size + this.size / 2 : this.size, 0, 2 * Math.PI, !0), e.closePath(), e.fill(), e.restore() } }; $.fn.fireworks = function (e) { return e || (e = "init"), this.each(function () { FUNCS[e](this) }), this } }(jQuery);
