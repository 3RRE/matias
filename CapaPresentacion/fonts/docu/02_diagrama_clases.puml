@startuml Diagrama_Clases_Sistema_Satisfaccion_Cliente

title Sistema de Satisfacción del Cliente - Diagrama de Clases

' Estilos
skinparam class {
    BackgroundColor<<Controller>> LightBlue
    BackgroundColor<<BL>> LightGreen
    BackgroundColor<<DAL>> LightYellow
    BackgroundColor<<Entity>> LightPink
    BackgroundColor<<DTO>> Wheat
}

package "CapaPresentacion.Controllers" {
    class ConfigClienteSatisfaccionController <<Controller>> {
        - preguntasBL : PreguntasBL
        - opcionesBL : OpcionesBL
        - flujoBL : FlujoBL
        - respuestaBL : RespuestaBL
        - tabletBL : TabletBL
        - configuracionBL : CSConfiguracionBL
        --
        + ReportesView() : ActionResult
        + PreguntasView() : ActionResult
        + TabletsView() : ActionResult
        + ObtenerPreguntaAtributos() : JsonResult
        + DataReportesEncuesta(fechaInicio, fechaFin) : JsonResult
        + DataReportesEncuestaCSAT(fechaInicio, fechaFin, salaId) : JsonResult
        + DataReportesIndicador(fechaInicio, fechaFin, indicador) : JsonResult
        + DataNPS(fechaInicio, fechaFin, salaId) : JsonResult
        + DataNCSAT(fechaInicio, fechaFin, salaId) : JsonResult
        + DataIndicador(fechaInicio, fechaFin, indicador, salaId) : JsonResult
        + ObtenerTabletsSala(salaId) : JsonResult
        + CrearTablet(tablet) : JsonResult
        + EditarTablet(tablet) : JsonResult
        + ExportarEncuestasExcel(salaId, fechaInicio, fechaFin) : JsonResult
        + ObtenerPreguntas(tipoEncuesta) : JsonResult
        + CrearPreguntaNormal(model) : JsonResult
        + CrearPreguntaAtributo(model) : JsonResult
        + EditarPregunta(model) : JsonResult
        + EliminarPregunta(idPregunta, tipo) : JsonResult
        + CrearOpcion(model) : JsonResult
        + EditarOpcion(model) : JsonResult
        + EliminarOpcion(idOpcion) : JsonResult
        + TogglePregunta(idPregunta) : JsonResult
        + ListarEncuestadosConComentarios(salaId, fechaInicio, fechaFin) : JsonResult
        + ListadoConfiguraciones(idSala) : JsonResult
        + ActualizarValorBit(idConfiguracion, nuevoValor, idSala) : JsonResult
    }

    class EscReportesController <<Controller>> {
        - respuestaBL : ESC_RespuestaBL
        - salaBL : SalaBL
        --
        + RespuestasView() : ActionResult
        + ObtenerReporteDeRespuestas(filtro) : JsonResult
        + GenerarExcelReporteDeRespuestas(filtro) : JsonResult
    }

    class EscRespuestasController <<Controller>> {
        - preguntaBL : ESC_PreguntaBL
        - respuestaBL : ESC_RespuestaBL
        - salaBL : SalaBL
        - configuracionBL : ESC_ConfiguracionBL
        --
        + GetRespuestasPorCodSala(codSala) : JsonResult
        + GetRespuestaById(id) : JsonResult
    }
}

package "CapaNegocio.ClienteSatisfaccion" {
    class PreguntasBL <<BL>> {
        - preguntasDAL : PreguntasDAL
        --
        + ListadoPreguntas(tipoEncuesta) : List<PreguntaEntidad>
        + ObtenerPreguntasAtributo() : List<PreguntaEntidad>
        + CrearPregunta(pregunta) : int
        + EditarPregunta(pregunta) : bool
        + EliminarPregunta(idPregunta) : bool
        + TogglePregunta(idPregunta) : bool
        + ObtenerPreguntasConOpcionesYFlujo() : List<PreguntaDTO>
    }

    class OpcionesBL <<BL>> {
        - opcionesDAL : OpcionesDAL
        --
        + ListadoOpciones() : List<OpcionEntidad>
        + CrearOpcion(opcion) : int
        + EditarOpcion(opcion) : bool
        + EliminarOpcion(idOpcion) : bool
    }

    class RespuestaBL <<BL>> {
        - respuestaDAL : RespuestaDAL
        --
        + GuardarRespuestaEncuesta(respuestaEncuesta) : int
        + GuardarRespuestaPregunta(respuestaPregunta) : int
        + ObtenerNPSIndicador(fechaInicio, fechaFin) : NpsResultadoDTO
        + ObtenerNPSMensual(fechaInicio, fechaFin) : List<NpsMensualDTO>
        + ObtenerNPSRespuestas(fechaInicio, fechaFin, salaId) : List<NpsRespuestaDTO>
        + ObtenerCSATIndicador(fechaInicio, fechaFin, salaId) : CsatResultadoDTO
        + ObtenerCSATMensual(fechaInicio, fechaFin) : List<CsatMensualDTO>
        + ObtenerCSATDiario(fechaInicio, fechaFin, salaId) : List<CsatDiarioDTO>
        + ObtenerListaCSATIRespuestas(fechaInicio, fechaFin, salaId) : List<CsatRespuesta>
        + ObtenerIndicador(indicador, fechaInicio, fechaFin) : IndicadorResultadoDTO
        + ObtenerIndicadorDiario(fechaInicio, fechaFin, indicador) : List<IndicadorDiarioDTO>
        + ObtenerListaIndicadorRespuestas(fechaInicio, fechaFin, indicador, salaId) : List<IndicadorRespuesta>
        + ObtenerRespuestasEncuestas(fechaInicio, fechaFin, salaId) : List<RespuestaPlanoDTO>
        + ObtenerPreguntasIndicadores() : List<PreguntaIndicadorDTO>
        + ObtenerEncuestados(salaId, fechaInicio, fechaFin) : List<EncuestadoDTO>
        + ObtenerRespuestasAtributos(salaId, fechaInicio, fechaFin) : List<RespuestaAtributoDTO>
        + ObtenerCantidadRespuestasAtributos(salaId, fechaInicio, fechaFin, indicador) : int
    }

    class TabletBL <<BL>> {
        - tabletDAL : TabletDAL
        --
        + ListadoTablets(salaId) : List<TabletEntidad>
        + CrearTablet(tablet) : bool
        + EditarTablet(nombre, activa, idTablet) : bool
    }

    class CSConfiguracionBL <<BL>> {
        - configuracionDAL : CSConfiguracionDAL
        --
        + ListadoConfiguraciones() : List<CSConfiguracionEntidad>
        + ListadoConfiguracionesPorSala(idSala) : List<CSConfiguracionEntidad>
        + ActualizarValorBit(idConfiguracion, nuevoValor, idSala) : bool
        + PuedeResponderEncuesta(idSala, nroDocumento) : bool
    }
}

package "CapaNegocio.SatisfaccionCliente" {
    class ESC_RespuestaBL <<BL>> {
        - respuestaDAL : ESC_RespuestaDAL
        --
        + ObtenerRespuestas() : List<ESC_RespuestaDto>
        + ObtenerRespuestasPorCodSala(codSala) : List<ESC_RespuestaDto>
        + ObtenerRespuestasPorCodSalaYFechas(codSala, fechaInicio, fechaFin) : List<ESC_RespuestaDto>
        + ObtenerReportePorcentajes(codSala, fechaInicio, fechaFin) : List<ESC_ReportePorcentaje>
        + ObtenerRespuestaPorId(id) : ESC_RespuestaDto
        + InsertarRespuesta(respuesta) : bool
        + InsertarRespuestas(request) : int
    }

    class ESC_PreguntaBL <<BL>> {
        - preguntaDAL : ESC_PreguntaDAL
        --
        + ObtenerPreguntas() : List<ESC_PreguntaDto>
        + ObtenerPreguntaPorId(id) : ESC_PreguntaDto
    }

    class ESC_ConfiguracionBL <<BL>> {
        - configuracionDAL : ESC_ConfiguracionDAL
        --
        + ObtenerConfiguraciones() : List<ESC_ConfiguracionDto>
        + ActualizarConfiguracion(config) : bool
    }
}

package "CapaDatos.ClienteSatisfaccion" {
    class RespuestaDAL <<DAL>> {
        - _conexion : string
        --
        + GuardarRespuestaEncuesta(respuestaEncuesta) : int
        + GuardarRespuestaPregunta(respuestaPregunta) : int
        + ObtenerNPSIndicador(fechaInicio, fechaFin) : NpsResultadoDTO
        + ObtenerNPSMensual(fechaInicio, fechaFin) : List<NpsMensualDTO>
        + ObtenerNPSRespuestas(fechaInicio, fechaFin, salaId) : List<NpsRespuestaDTO>
        + ObtenerCSATIndicador(fechaInicio, fechaFin, salaId) : CsatResultadoDTO
        + ObtenerCSATMensual(fechaInicio, fechaFin) : List<CsatMensualDTO>
        + ObtenerCSATDiario(fechaInicio, fechaFin, salaId) : List<CsatDiarioDTO>
        + ObtenerIndicador(indicador, fechaInicio, fechaFin) : IndicadorResultadoDTO
        + ObtenerIndicadorDiario(fechaInicio, fechaFin, indicador) : List<IndicadorDiarioDTO>
    }

    class PreguntasDAL <<DAL>> {
        - _conexion : string
        --
        + ListadoPreguntas(tipoEncuesta) : List<PreguntaEntidad>
        + CrearPregunta(pregunta) : int
        + EditarPregunta(pregunta) : bool
        + EliminarPregunta(idPregunta) : bool
        + TogglePregunta(idPregunta) : bool
    }

    class OpcionesDAL <<DAL>> {
        - _conexion : string
        --
        + ListadoOpciones() : List<OpcionEntidad>
        + CrearOpcion(opcion) : int
        + EditarOpcion(opcion) : bool
        + EliminarOpcion(idOpcion) : bool
    }

    class TabletDAL <<DAL>> {
        - _conexion : string
        --
        + ListadoTablets(salaId) : List<TabletEntidad>
        + CrearTablet(tablet) : bool
        + EditarTablet(nombre, activa, idTablet) : bool
    }

    class CSConfiguracionDAL <<DAL>> {
        - _conexion : string
        --
        + ListadoConfiguraciones() : List<CSConfiguracionEntidad>
        + ListadoConfiguracionesPorSala(idSala) : List<CSConfiguracionEntidad>
        + ActualizarValorBit(idConfiguracion, nuevoValor, idSala) : bool
        + PuedeResponderEncuesta(idSala, nroDocumento) : bool
    }
}

package "CapaDatos.SatisfaccionCliente" {
    class ESC_RespuestaDAL <<DAL>> {
        - _conexion : string
        --
        + InsertarRespuesta(respuesta) : int
        + ObtenerRespuestas() : List<ESC_RespuestaDto>
        + ObtenerRespuestasPorCodSala(codSala) : List<ESC_RespuestaDto>
        + ObtenerRespuestasPorCodSalaYFechas(codSala, fechaInicio, fechaFin) : List<ESC_RespuestaDto>
        + ObtenerReportePorcentajes(codSala, fechaInicio, fechaFin) : List<ESC_ReportePorcentaje>
        - ConstruirObjeto(dr) : ESC_RespuestaDto
        - ConstruirObjetoReportePorcentaje(dr) : ESC_ReportePorcentaje
    }
}

package "CapaEntidad.ClienteSatisfaccion" {
    class PreguntaEntidad <<Entity>> {
        + IdPregunta : int
        + IdTipoEncuesta : int
        + Texto : string
        + Indicador : string
        + Orden : int
        + Random : bool
        + Multi : bool
        + Activo : bool
        + FechaInicio : DateTime?
        + FechaFin : DateTime?
    }

    class OpcionEntidad <<Entity>> {
        + IdOpcion : int
        + IdPregunta : int
        + Texto : string
        + TieneComentario : bool
        + Valor : int
    }

    class RespuestaEncuestaEntidad <<Entity>> {
        + IdRespuestaEncuesta : int
        + IdSala : int
        + IdTablet : int
        + NroDocumento : string
        + TipoDocumento : string
        + FechaRespuesta : DateTime
        + IdTipoEncuesta : int
        + Nombre : string
        + Correo : string
        + Celular : string
    }

    class RespuestaPreguntaEntidad <<Entity>> {
        + IdRespuestaPregunta : int
        + IdRespuestaEncuesta : int
        + IdPregunta : int
        + IdOpcion : int
        + Comentario : string
    }

    class TabletEntidad <<Entity>> {
        + IdTablet : int
        + IdSala : int
        + Nombre : string
        + Activa : bool
    }

    class CSConfiguracionEntidad <<Entity>> {
        + IdConfiguracion : int
        + Nombre : string
        + Valor : bool
        + IdSala : int
    }
}

package "CapaEntidad.ClienteSatisfaccion.DTO" {
    class NpsResultadoDTO <<DTO>> {
        + TotalRespuestas : int
        + CantDetractores : int
        + CantPasivos : int
        + CantPromotores : int
        + PctDetractores : double
        + PctPasivos : double
        + PctPromotores : double
        + NPS : int
    }

    class CsatResultadoDTO <<DTO>> {
        + TotalRespuestas : int
        + CantMuyInsatisfecho : int
        + CantInsatisfecho : int
        + CantNeutral : int
        + CantSatisfecho : int
        + CantMuySatisfecho : int
        + MuyInsatisfecho : double
        + Insatisfecho : double
        + Neutral : double
        + Satisfecho : double
        + MuySatisfecho : double
        + CSAT : double
    }

    class IndicadorResultadoDTO <<DTO>> {
        + Indicador : string
        + TotalRespuestas : int
        + CantMuyInsatisfecho : int
        + CantInsatisfecho : int
        + CantNeutral : int
        + CantSatisfecho : int
        + CantMuySatisfecho : int
        + PctMuyInsatisfecho : double
        + PctInsatisfecho : double
        + PctNeutral : double
        + PctSatisfecho : double
        + PctMuySatisfecho : double
        + IndicadorValor : int
    }

    class CsatDiarioDTO <<DTO>> {
        + Fecha : DateTime
        + TotalRespuestas : int
        + CantMuyInsatisfecho : int
        + CantInsatisfecho : int
        + CantNeutral : int
        + CantSatisfecho : int
        + CantMuySatisfecho : int
        + MuyInsatisfecho : double
        + Insatisfecho : double
        + Neutral : double
        + Satisfecho : double
        + MuySatisfecho : double
        + CSAT : double
    }

    class NpsMensualDTO <<DTO>> {
        + Anio : int
        + Mes : int
        + PeriodoMes : string
        + TotalRespuestas : int
        + NPS : int
    }

    class EncuestadoDTO <<DTO>> {
        + IdRespuestaEncuesta : int
        + IdSala : int
        + IdTablet : int
        + NroDocumento : string
        + TipoDocumento : string
        + FechaRespuesta : DateTime
        + Nombre : string
        + Correo : string
        + Celular : string
        + PreguntaNPS : string
        + ValorRespuesta : int?
        + Clasificacion : string
    }

    class RespuestaAtributoDTO <<DTO>> {
        + IdRespuestaEncuesta : int
        + IdPregunta : int
        + Pregunta : string
        + Opcion : string
        + Comentario : string
    }
}

package "CapaEntidad.SatisfaccionCliente" {
    class ESC_Respuesta <<Entity>> {
        + Id : int
        + IdRespuestaSala : int
        + IdPregunta : int
        + Puntaje : ESC_Puntaje
        + NumeroDocumento : string
        + FechaRegistro : DateTime
    }

    class ESC_RespuestaDto <<DTO>> {
        + Id : int
        + Pregunta : ESC_PreguntaDto
        + Puntaje : ESC_Puntaje
        + PuntajeStr : string
        + Cliente : ESC_ClienteDto
        + FechaRegistro : DateTime
        + Existe() : bool
    }

    enum ESC_Puntaje {
        MuyMalo = 1
        Malo = 2
        Regular = 3
        Bueno = 4
        MuyBueno = 5
    }

    class ESC_ReportePorcentaje <<DTO>> {
        + Puntaje : ESC_Puntaje
        + TotalRespuestas : int
        + CantidadRespuestas : int
        + Porcentaje : double
    }
}

' Relaciones Controllers -> BL
ConfigClienteSatisfaccionController --> PreguntasBL
ConfigClienteSatisfaccionController --> OpcionesBL
ConfigClienteSatisfaccionController --> RespuestaBL
ConfigClienteSatisfaccionController --> TabletBL
ConfigClienteSatisfaccionController --> CSConfiguracionBL

EscReportesController --> ESC_RespuestaBL
EscRespuestasController --> ESC_RespuestaBL
EscRespuestasController --> ESC_PreguntaBL
EscRespuestasController --> ESC_ConfiguracionBL

' Relaciones BL -> DAL
PreguntasBL --> PreguntasDAL
OpcionesBL --> OpcionesDAL
RespuestaBL --> RespuestaDAL
TabletBL --> TabletDAL
CSConfiguracionBL --> CSConfiguracionDAL
ESC_RespuestaBL --> ESC_RespuestaDAL

' Relaciones DAL -> Entities/DTOs
RespuestaDAL ..> RespuestaEncuestaEntidad
RespuestaDAL ..> RespuestaPreguntaEntidad
RespuestaDAL ..> NpsResultadoDTO
RespuestaDAL ..> CsatResultadoDTO
RespuestaDAL ..> IndicadorResultadoDTO
RespuestaDAL ..> CsatDiarioDTO
RespuestaDAL ..> NpsMensualDTO
RespuestaDAL ..> EncuestadoDTO
RespuestaDAL ..> RespuestaAtributoDTO

PreguntasDAL ..> PreguntaEntidad
OpcionesDAL ..> OpcionEntidad
TabletDAL ..> TabletEntidad
CSConfiguracionDAL ..> CSConfiguracionEntidad

ESC_RespuestaDAL ..> ESC_Respuesta
ESC_RespuestaDAL ..> ESC_RespuestaDto
ESC_RespuestaDAL ..> ESC_ReportePorcentaje

' Relaciones entre entidades
RespuestaEncuestaEntidad "1" -- "*" RespuestaPreguntaEntidad
PreguntaEntidad "1" -- "*" OpcionEntidad
PreguntaEntidad "1" -- "*" RespuestaPreguntaEntidad
OpcionEntidad "1" -- "*" RespuestaPreguntaEntidad
TabletEntidad "1" -- "*" RespuestaEncuestaEntidad

ESC_RespuestaDto --> ESC_Puntaje
ESC_Respuesta --> ESC_Puntaje
ESC_ReportePorcentaje --> ESC_Puntaje

@enduml
